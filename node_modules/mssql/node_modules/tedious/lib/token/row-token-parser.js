// Generated by CoffeeScript 1.6.2
var DIGITS_REGEX, parser, saveColumn, sprintf, valueParse;

valueParse = require('../value-parser');

sprintf = require('sprintf').sprintf;

DIGITS_REGEX = /^\d+$/;

parser = function(buffer, columnsMetaData) {
  var column, columnMetaData, columns, value, _i, _len;

  columns = [];
  for (_i = 0, _len = columnsMetaData.length; _i < _len; _i++) {
    columnMetaData = columnsMetaData[_i];
    value = valueParse(buffer, columnMetaData);
    column = {
      value: value,
      metadata: columnMetaData
    };
    columns.push(column);
    if (!(DIGITS_REGEX.test(columnMetaData.colName))) {
      saveColumn(columnMetaData.colName, columns, column);
    }
  }
  return {
    name: 'ROW',
    event: 'row',
    columns: columns
  };
};

saveColumn = function(columnName, columns, value) {
  var entry;

  entry = columns[columnName];
  if (!entry) {
    return columns[columnName] = value;
  } else if (Array.isArray(entry)) {
    return entry.push(value);
  } else {
    return columns[columnName] = [entry, value];
  }
};

module.exports = parser;
